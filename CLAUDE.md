# Claude Code Project Context

## Canonical Working Directory

**Always work from:** `~/atlas-local`

Do NOT use the iCloud Drive path (`~/Library/Mobile Documents/...`). Node.js, git, and file operations fail on iCloud paths due to on-demand file downloading.

## Running Dev Servers

From `~/atlas-local`, use the project's installed binaries (not npx):

```bash
# Web (terminal 1)
cd ~/atlas-local/apps/web
./node_modules/.bin/next dev

# API (terminal 2)
cd ~/atlas-local/apps/api
./node_modules/.bin/next dev --port 3001
```

Both servers must be running for the app to work. The web app calls the API at `http://localhost:3001`.

## Environment Files

- `apps/web/.env.local` — App URLs
- `apps/api/.env.local` — Supabase credentials, Anthropic API key

These are gitignored. Do not commit them.

## Key Technical Details

- **Package manager:** pnpm (not npm/yarn)
- **Framework:** Next.js 14.1.0 App Router
- **Styling:** Tailwind CSS with custom design tokens
- **Database:** Supabase (Postgres)
- **AI:** Anthropic Claude API with SSE streaming
- **State:** React Context with useReducer (AssessmentContext + WorkspaceContext)

## Common Issues

- **"Failed to fetch" on start page:** API server isn't running on port 3001
- **"No response received":** Check API server logs; likely Anthropic API key or credits issue
- **npx downloads wrong Next.js version:** Always use `./node_modules/.bin/next` instead of npx

## Agent Registry

All agents, hooks, and automations are documented in **`AGENTS.md`** at the project root. **Whenever you create, modify, or remove an agent, hook, GitHub Action, or automation of any kind, you MUST update AGENTS.md to reflect the change.**

---

*The sections below are auto-generated by `scripts/update-claude-context.sh` after each commit.*

<!-- AUTO:STRUCTURE -->

## Project Structure

```
.
.git
.github
.github/workflows
.github/workflows/update-docs.yml
.gitignore
.prettierrc
.turbo
AGENTS.md
apps
apps/api
apps/api/.env.example
apps/api/.env.local
apps/api/.eslintrc.json
apps/api/.next
apps/api/.turbo
apps/api/next-env.d.ts
apps/api/next.config.js
apps/api/node_modules
apps/api/package.json
apps/api/src
apps/api/src/app
apps/api/src/lib
apps/api/src/middleware.ts
apps/api/tsconfig.json
apps/api/tsconfig.tsbuildinfo
apps/api/vercel.json
apps/web
apps/web/.env.example
apps/web/.env.local
apps/web/.eslintrc.json
apps/web/.next
apps/web/.turbo
apps/web/next-env.d.ts
apps/web/next.config.js
apps/web/node_modules
apps/web/package.json
apps/web/postcss.config.js
apps/web/src
apps/web/src/app
apps/web/src/components
apps/web/src/lib
apps/web/tailwind.config.ts
apps/web/tsconfig.json
apps/web/tsconfig.tsbuildinfo
apps/web/vercel.json
CLAUDE.md
docs
docs/CONTENT-PANEL-V3-SPEC.md
docs/DESIGN-OVERHAUL-BRIEF.md
docs/DESIGN-SYSTEM-V3.md
docs/FOUNDER-FEEDBACK-V3-PLAN.md
docs/MVP-BUILD-DOCUMENTATION.md
docs/PRD-Progress-Visibility-Feature.md
docs/product
docs/product/central-console-feedback-v1.md
docs/ux
docs/UX-UI-Design-Specifications.md
docs/ux/comprehensive-ux-audit-v1.md
node_modules
package.json
packages
packages/config
packages/config/node_modules
packages/config/package.json
packages/config/src
packages/config/src/index.ts
packages/config/tsconfig.json
packages/types
packages/types/node_modules
packages/types/package.json
packages/types/src
packages/types/src/index.ts
packages/types/tsconfig.json
pnpm-lock.yaml
pnpm-workspace.yaml
scripts
scripts/update-claude-context.sh
scripts/update-docs.ts
supabase
```
<!-- /AUTO:STRUCTURE -->

<!-- AUTO:ROUTES -->

## App Routes (Web)

- /chat — apps/web/src/app/chat/page.tsx
- /how-it-works — apps/web/src/app/how-it-works/page.tsx
- / — apps/web/src/app/page.tsx
- /privacy — apps/web/src/app/privacy/page.tsx
- /snapshot — apps/web/src/app/snapshot/page.tsx
- /start — apps/web/src/app/start/page.tsx
- /terms — apps/web/src/app/terms/page.tsx
- /workspace — apps/web/src/app/workspace/page.tsx

<!-- /AUTO:ROUTES -->

<!-- AUTO:COMPONENTS -->

## Component Inventory (Web)

- **components/workspace/** (3): TopBar,WelcomeModal,WorkspaceLayout
- **components/workspace/sidebar/** (4): Sidebar,SidebarDomainItem,SidebarFooter,SidebarTopicItem
- **components/workspace/content/** (8): CategoryCard,ContentDomainHeader,ContentPanel,EmptyState,InlineSnapshotCTA,InsightCard,NotStartedCard,TopicCard
- **components/workspace/chat/** (4): ChatHeader,ChatPanel,InputCapturedIndicator,TopicTransitionBanner
- **components/workspace/mobile/** (1): MobileTabBar
- **components/ui/** (13): button,confidence-badge,confirm-dialog,error-card,input,network-banner,overflow-menu,progress-bar-mini,progress,skeleton-loader,skeleton,status-indicator,tooltip
- **components/snapshot/** (7): assumptions-section,coverage-overview,export-section,gaps-section,key-findings,next-steps-section,strengths-section

<!-- /AUTO:COMPONENTS -->

<!-- AUTO:API -->

## API Routes

- /api/chat/init — apps/api/src/app/api/chat/init/route.ts
- /api/chat — apps/api/src/app/api/chat/route.ts
- /api/domain/summary — apps/api/src/app/api/domain/summary/route.ts
- /api/export/pdf/[sessionId] — apps/api/src/app/api/export/pdf/[sessionId]/route.ts
- /api/export/send/[sessionId] — apps/api/src/app/api/export/send/[sessionId]/route.ts
- /api/health — apps/api/src/app/api/health/route.ts
- /api/session/[id] — apps/api/src/app/api/session/[id]/route.ts
- /api/session/recover — apps/api/src/app/api/session/recover/route.ts
- /api/session — apps/api/src/app/api/session/route.ts
- /api/snapshot/[sessionId] — apps/api/src/app/api/snapshot/[sessionId]/route.ts
- /api/snapshot/generate — apps/api/src/app/api/snapshot/generate/route.ts

**Lib modules:**

- lib/ai/agents/conversation.ts
- lib/ai/client.ts
- lib/ai/confidence/classifier.ts
- lib/ai/prompts/domains.ts
- lib/ai/prompts/synthesis.ts
- lib/ai/prompts/system.ts
- lib/db/index.ts
- lib/db/inputs.ts
- lib/db/messages.ts
- lib/db/session.ts
- lib/db/supabase.ts
- lib/email/client.ts
- lib/email/index.ts
- lib/email/templates/snapshot-email.ts
- lib/errors.ts
- lib/pdf/index.ts
- lib/pdf/theme.ts

<!-- /AUTO:API -->

<!-- AUTO:RECENT_CHANGES -->

## Recent Commits

```
3bf6175 Auto-send topic message when clicking 'Talk to Atlas'
8c8e097 Fix 'Talk to Atlas' button to focus chat and pre-fill topic prompt
d551109 docs: auto-update MVP documentation [skip ci]
4cfbd0d Add server-side validation to reject invalid questionIds
0c0886d Fix domain progress to only count valid question IDs
e4168d0 Fix AI behavior: don't revisit completed topics, require all topics before transition
9b0a640 Fix UI issues: pill order, confidence labels, domain summary
e50ffe9 docs: auto-update MVP documentation [skip ci]
d7c9095 Upgrade to Claude 4.5 models (Sonnet + Haiku)
796f2a6 Switch to Claude 3 Haiku for broader compatibility
```
<!-- /AUTO:RECENT_CHANGES -->
